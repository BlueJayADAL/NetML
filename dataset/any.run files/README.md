any.run (https://any.run/) is an online sandbox service with both free and paid plans.  Its service is unique in that it allows interaction with virtual machines, rather than the simple automatic execution offered by most other sandboxes.  This interaction is useful since it allows real-time monitoring of samples to see network activity.

A total of ~1300 malware samples were downloaded from MalShare (https://malshare.com/) using its official API toolkit (https://github.com/Malshare/MalShare-Toolkit) and the daily digest functionality; samples were pulled from May 30 (the hash list is available at https://malshare.com/daily/2019-06-30/malshare_fileList.2019-06-30.txt).

After samples are pulled, they are scanned using VirusTotal (https://www.virustotal.com/gui/home/upload).  The purpose of this scanning is to filter samples.  Malware samples that are marked as malicious by <50% of antivirus software represented by VirusTotal are discarded; the rest are tested on any.run.

Each sample is allowed to run for a minimum of 60 seconds in any.run.  If no network activity is registered, then I moved on to the next sample; if network activity is registered, I allowed the sample to run for 5 minutes.  Thus the pcap files represented here were allowed to run for 5 minutes.  Each sample was run on a 32-bit Windows 7 machine with full internet access.

The filtering approach has a few problems.  First, many of the files pulled from MalShare are html files (the result of URL rather than binary submissions), which do not register on antivirus software.  Secondly, MalShare enforces a daily limit of 1000 downloads per day, which exceeds the number pulled using its daily digest functionality.  As such, ~300 of the files pulled are text files containing the message ("Error: Over Request Limit.  Please contact admin if you need this increased."  These files are worthless in the analysis and end up unnecessarily extending the filtering stage's length.  Finally, the files that make it through the filtering stage are biased towards Windows-specific malwares.  For example, many of the rejected files are detected by antivirus as Linux backdoors; bitcoin-mining botnets are also rejected.  While these malwares are detected by some antivirus, the rate is not high enough to exceed the 50% threshold; additionally, running Linux malwares is complicated since most sandboxes specialize in virtualizing Windows environments.

For those files that do pass the filtering stage, there are three possibilities: a failure to run, a failure to generate network activity, and successful generation of network activity.  Some files simply do not run; this may be because of the emulated Windows 7 environment of any.run.  Other files do not generate any network activity; these malwares make changes to the Windows registry or perform other system-related procedures (such as modifying boot procedures or changing paths).  For these files, I stopped the analysis at 1 minute.  A small percentage of files do, however, generate network traffic.  If traffic was generated within 1 minute of execution, I allowed the analysis to run for 4 more minutes.  Most of these files are executibles, but some are Excel files.  The name of each pcap file corresponds to the md5 hash of the file that produced it.

I save all of the sample files, including those that didn't pass the filtering stage.  any.run also keeps track of each analysis, so I can go back and look at each analysis again and re-download pcap files.
